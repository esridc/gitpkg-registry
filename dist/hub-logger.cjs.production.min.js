"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=(e=require("morgan"))&&"object"==typeof e&&"default"in e?e.default:e;function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var n=require("winston"),o={error:4,warn:3,info:2,debug:1};function i(e){void 0===e&&(e="");var t=/(.+?\.js):(\d+):\d+/;return(e.split("\n").find((function(e){return t.test(e)}))||"").trim()}function s(e,t,n,o){void 0===o&&(o={});var i=t instanceof Date?t.toISOString():t;return Object.entries(r({level:e,timestamp:i,status:n},o)).map((function(e){return e[0]+"="+JSON.stringify(e[1])})).join(" ")}exports.HubLogger=function(){function e(e){var t,r;void 0===e&&(e={}),this.sizeLimit=this.getSizeLimit(e.sizeLimit),this.globalLabels=null!=(t=e.labels)?t:{},this.level=null!=(r=e.level)?r:"info";var o=new n.transports.Console({level:this.level,format:n.format.printf((function(e){return e.message})),handleExceptions:!0,handleRejections:!0});this.winstonLogger=n.createLogger({transports:[o]})}var r=e.prototype;return r.log=function(e,t,r){var n=new Date,o=s(e,n,t,Object.assign({},this.globalLabels,r));o.length>this.sizeLimit&&(this.warn("oversize-log-truncated",{timestamp:n.toISOString()}),o=("TOO LONG TRUNCATED "+o.slice(0,this.sizeLimit)).trim()),this.winstonLogger[e](o)},r.getSizeLimit=function(e){var t;return(e=null!=(t=e)?t:2e5)<100?100:e>2e5?2e5:e},r.info=function(e,t){this.log("info",e,t)},r.debug=function(e,t){this.log("debug",e,t)},r.warn=function(e,t){this.log("warn",e,t)},r.error=function(e,t){var r;t instanceof Error?(r={errorName:t.name,errorMessage:t.message},t.stack&&(r.source=i(t.stack))):r=t,this.log("error",e,r)},r.shouldLog=function(e){return o[e]>=o[this.level]},r.getRequestLogLevel=function(e){return!e||e>=500?"error":e>=400?"warn":"debug"},r.getRequestLogStatus=function(e){return"http-request-"+("debug"===e?"succeeded":"failed")},r.createRequestLogger=function(e){var r=this;void 0===e&&(e={});var n=Object.assign({},e,{skip:function(e,t){return!r.shouldLog(r.getRequestLogLevel(t.statusCode))}});return t((function(e,t,n){var o=e.method(t,n),i=e.url(t,n),u=n.statusCode,a=e.date(t,n,"iso"),l=Number(e["response-time"](t,n)),g=r.getRequestLogLevel(n.statusCode);return s(g,a,r.getRequestLogStatus(g),Object.assign({},r.globalLabels,{method:o,url:i,statusCode:u,responseTime:l}))}),n)},e}(),exports.formatLog=s,exports.getErrorSource=i;
//# sourceMappingURL=hub-logger.cjs.production.min.js.map
